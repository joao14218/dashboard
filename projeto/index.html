<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Arena Louzada</title>
    <style>
        :root{--primary-color:#ffc400;--dark-bg:#1a1a1a;--dark-card:#2c2c2c;--text-light:#f0f0f0;--border-color:#444;}
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
        body{display:flex;justify-content:center;align-items:center;min-height:100vh;background-color:var(--dark-bg);color:var(--text-light)}
        .login-card{background-color:var(--dark-card);padding:40px;border-radius:10px;width:100%;max-width:400px;text-align:center;animation:fadeIn .5s ease-out}
        @keyframes fadeIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
        .login-header img{width:100px;height:100px;border-radius:50%;margin-bottom:10px;border:2px solid var(--primary-color)}
        .login-header h1{margin-bottom:20px}
        .form-group{margin-bottom:20px;text-align:left}
        .form-group label{display:block;margin-bottom:8px;font-weight:600}
        .form-group input{width:100%;padding:12px;border-radius:8px;background-color:#3a3a3a;border:1px solid var(--border-color);color:var(--text-light);font-size:1rem}
        .login-btn{width:100%;padding:15px;border:none;border-radius:8px;background-color:var(--primary-color);color:#000;font-size:1.1rem;font-weight:bold;cursor:pointer;transition:background-color .3s}
        .error-message{color:#e74c3c;margin-top:15px;font-weight:600;min-height:20px}
    </style>
</head>
<body>
    <div class="login-card">
        <div class="login-header">
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSNV8dxYF7dGp6TSUvr5KLLddCultBUPuo8XA&s" alt="Logo Arena Louzada">
            <h1>ARENA LOUZADA</h1>
        </div>
        <form id="login-form">
            <div class="form-group">
                <label for="username">Usuário</label>
                <input type="text" id="username" required>
            </div>
            <div class="form-group">
                <label for="password">Senha</label>
                <input type="password" id="password" required>
            </div>
            <p id="error-message" class="error-message"></p>
            <button type="submit" class="login-btn" id="submit-btn">Entrar no Sistema</button>
        </form>
    </div>

    <script src="auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loginForm = document.getElementById('login-form');
            const errorMessage = document.getElementById('error-message');
            const submitBtn = document.getElementById('submit-btn');

            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                submitBtn.textContent = 'Verificando...';
                submitBtn.disabled = true;
                errorMessage.textContent = '';

                try {
                    // Comunica com o backend Python no PythonAnywhere
                    const response = await fetch(`${window.API_URL}/login`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ username, password })
                    });

                    const data = await response.json();

                    if (response.ok) {
                        // Salva o Token e o cargo gerados pelo Python
                        sessionStorage.setItem('token', data.access_token);
                        sessionStorage.setItem('userRole', data.role);
                        
                        const redirectMap = {
                            'CEO': 'dashboard.html',
                            'Administrador': 'dashboard.html',
                            'Professor': 'alunos.html',
                            'Vendedor': 'vendas.html'
                        };
                        
                        window.location.href = redirectMap[data.role] || 'index.html';

                    } else {
                        errorMessage.textContent = data.error || 'Usuário ou senha inválidos.';
                    }
                } catch (error) {
                    console.error('Erro de conexão:', error);
                    errorMessage.textContent = 'Erro ao conectar com o servidor. Verifique a internet.';
                } finally {
                    submitBtn.textContent = 'Entrar no Sistema';
                    submitBtn.disabled = false;
                }
            });
        });
    </script>
</body>
</html>
